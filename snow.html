<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Snow Text Advanced</title>

<script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>

<style>
  body {
    margin: 0;
    background: black;
    overflow: hidden;
  }
  canvas {
    display: block;
  }
</style>
</head>
<body>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

canvas.width = innerWidth;
canvas.height = innerHeight;

// ================= BACKGROUND SNOW =================
const bgSnow = [];
for (let i = 0; i < 150; i++) {
  bgSnow.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    s: Math.random() * 1.5 + 0.5,
    w: Math.random() * Math.PI * 2
  });
}

// ================== BUAT TEKS ==================
ctx.fillStyle = "white";
ctx.font = "100px Arial";
ctx.textAlign = "center";
ctx.fillText("I LOVE YOUU", canvas.width / 2, canvas.height / 2);

const data = ctx.getImageData(0, 0, canvas.width, canvas.height);
ctx.clearRect(0, 0, canvas.width, canvas.height);

// ================== TEXT SNOW ==================
const textSnow = [];
for (let y = 0; y < canvas.height; y += 6) {
  for (let x = 0; x < canvas.width; x += 6) {
    const i = (y * canvas.width + x) * 4;
    if (data.data[i + 3] > 120) {
      textSnow.push({
        x: Math.random() * canvas.width,
        y: Math.random() * -canvas.height,
        tx: x,
        ty: y,
        a: Math.random() * Math.PI * 2
      });
    }
  }
}

// ================== ANIMASI BENTUK & PECAH ==================
function formText() {
  gsap.to(textSnow, {
    x: i => textSnow[i].tx,
    y: i => textSnow[i].ty,
    duration: 3,
    stagger: 0.002,
    ease: "power2.out",
    onComplete: breakText
  });
}

function breakText() {
  gsap.to(textSnow, {
    x: () => Math.random() * canvas.width,
    y: () => canvas.height + Math.random() * 200,
    duration: 3,
    stagger: 0.001,
    ease: "power1.in",
    delay: 2,
    onComplete: formText
  });
}

formText();

// ================== LOOP ==================
let wind = 0;

function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "white";

  wind += 0.01;
  const windForce = Math.sin(wind) * 0.5;

  // background snow (ANGIN)
  bgSnow.forEach(s => {
    s.w += 0.01;
    s.y += s.s;
    s.x += Math.sin(s.w) + windForce;

    if (s.y > canvas.height) {
      s.y = 0;
      s.x = Math.random() * canvas.width;
    }

    ctx.beginPath();
    ctx.arc(s.x, s.y, 2, 0, Math.PI * 2);
    ctx.fill();
  });

  // text snow (HIDUP)
  textSnow.forEach(p => {
    p.a += 0.05;
    ctx.beginPath();
    ctx.arc(
      p.x + Math.sin(p.a) * 1.2,
      p.y + Math.cos(p.a) * 1.2,
      2,
      0,
      Math.PI * 2
    );
    ctx.fill();
  });

  requestAnimationFrame(animate);
}
animate();
</script>

</body>
</html>